<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>DCS Reference: A simple server example</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">DCS Reference
   &#160;<span id="projectnumber">2.4</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">A simple server example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is a simple example intended to illustrate the usage of the raw DCS API server components.</p>
<p><br/>
 </p>
<div class="fragment"><pre class="fragment"><span class="comment">/****************************************************************************</span>
<span class="comment"> *****                                                                  *****</span>
<span class="comment"> *****                   Classification: UNCLASSIFIED                   *****</span>
<span class="comment"> *****                    Classified By:                                *****</span>
<span class="comment"> *****                    Declassify On:                                *****</span>
<span class="comment"> *****                                                                  *****</span>
<span class="comment"> ****************************************************************************</span>
<span class="comment"> *</span>
<span class="comment"> *</span>
<span class="comment"> * Developed by: Naval Research Laboratory, Tactical Electronic Warfare Div.</span>
<span class="comment"> *               EW Modeling &amp; Simulation, Code 5770</span>
<span class="comment"> *               4555 Overlook Ave.</span>
<span class="comment"> *               Washington, D.C. 20375-5339</span>
<span class="comment"> *</span>
<span class="comment"> * For more information please send email to simdis@enews.nrl.navy.mil</span>
<span class="comment"> *</span>
<span class="comment"> * 2002 - U.S. Naval Research Laboratory.</span>
<span class="comment"> *</span>
<span class="comment"> * The U.S. Government retains all rights to use, duplicate, distribute,</span>
<span class="comment"> * disclose, or release this software.</span>
<span class="comment"> *</span>
<span class="comment"> */</span>

<span class="comment">// // // // // // // // // // // // // // // // // // // // // // //</span>
<span class="comment">// sserver - a simple server program implemented from the raw DCS API</span>

<span class="preprocessor">#include &lt;sstream&gt;</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;time.h&gt;</span>
<span class="preprocessor">#include &lt;math.h&gt;</span>
<span class="preprocessor">#include &lt;float.h&gt;</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>
<span class="preprocessor">#include &lt;memory.h&gt;</span>
<span class="preprocessor">#include &lt;signal.h&gt;</span>
<span class="preprocessor">#include &lt;sys/timeb.h&gt;</span>
<span class="preprocessor">#include &quot;DCS.h&quot;</span>

<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;conio.h&gt;</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="comment">// // // // // // // // // // // // // // // // // // // // // // //</span>
<span class="comment">// Character string specifying the network address of the network</span>
<span class="comment">// interface to use for data transmission. To use any network</span>
<span class="comment">// interface (INADDR_ANY), set to NULL.</span>
<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* IFACE = NULL;


<span class="comment">// Default UDP data mode.  The UDP mode can be set with a command line</span>
<span class="comment">// argument, but also has a default value defined here as a macro to make</span>
<span class="comment">// the application easier to test from Microsoft Visual Studio, where</span>
<span class="comment">// specifying command line arguments is not as simple as typing an argument</span>
<span class="comment">// at the command line.  Alternatively, command line arguments can be</span>
<span class="comment">// specified for Microsoft Visual Studio from the &quot;Debug&quot; tab of the</span>
<span class="comment">// project settings dialog.</span>
<span class="preprocessor">#define DEFAULTMODE DCSDATA_MULTICAST</span>
<span class="preprocessor"></span>

<span class="preprocessor">#define DELAY 1000000 // Microseconds in between data updates</span>
<span class="preprocessor"></span><span class="preprocessor">#define MAXPLAT 10   // Maximum number of platforms to create</span>
<span class="preprocessor"></span><span class="preprocessor">#define PLATTIME 1   // New platform every 1 second</span>
<span class="preprocessor"></span>

<span class="comment">// // // // // // // // // // // // // // // // // // // // // // //</span>
<span class="comment">// Convienent math defines</span>

<span class="preprocessor">#ifndef M_PI</span>
<span class="preprocessor"></span><span class="preprocessor">#define M_PI 3.1415926535897932384626433832795</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifndef DEG2RAD</span>
<span class="preprocessor"></span><span class="preprocessor">#define DEG2RAD 0.017453292519943295769236907684886</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="comment">// // // // // // // // // // // // // // // // // // // // // // //</span>
<span class="comment">// Reference origin for scenario</span>

<span class="preprocessor">#define REFLAT (22.0*DEG2RAD)</span>
<span class="preprocessor"></span><span class="preprocessor">#define REFLON (-159.0*DEG2RAD)</span>
<span class="preprocessor"></span>

<span class="comment">// // // // // // // // // // // // // // // // // // // // // // //</span>
<span class="comment">// Arrays of colors, used for beams and gates</span>
uint32_t bcolors[10] = {0xFF0000FF,0xFFFFFFFF,0x0000FFFF,0x000000FF,0xFF0000FF,
                        0x00FF00FF,0x0000FFFF,0xFFFF00FF,0xFF00FFFF,0x00FFFFFF};
uint32_t gcolors[10] = {0x00FFFFFF,0xFF00FFFF,0xFFFF00FF,0x0000FFFF,0x00FF00FF,
                        0xFF0000FF,0x000000FF,0xFF0000FF,0xFFFFFFFF,0x0000FFFF};


<span class="comment">// // // // // // // // // // // // // // // // // // // // // // //</span>
<span class="comment">// flag to denote the server&#39;s status</span>
<span class="keywordtype">int</span> running(1);


<span class="comment">// In order to properly stop the server, we set a signal that allows</span>
<span class="comment">// the user to stop the process by pressing Ctl C</span>
<span class="keywordtype">void</span> serverInterrupt()
{
  signal(SIGINT,SIG_IGN);
  cout &lt;&lt; <span class="stringliteral">&quot;SimpleServer interrupt called&quot;</span> &lt;&lt; endl;
  <span class="keywordflow">if</span> (running)
  {
    running = <span class="keyword">false</span>;
  }
  <span class="keywordflow">else</span>
  {
    exit(0);
  }
}


<span class="comment">// Our object for error reporting</span>
<a class="code" href="classDCSConsoleLogger.html" title="A class for logging DCS data structures to the console.">DCSConsoleLogger</a> logger;


<span class="comment">// fixes angles, in radians, between 0 and two PI</span>
<span class="keyword">inline</span> <span class="keywordtype">double</span> ANGFIX(<span class="keywordtype">double</span> x)
{
  <span class="keywordflow">return</span> ((x = fmod(x,(M_PI*2.0)))&lt;0.0)?(x+(M_PI*2.0)):x;
}


<span class="comment">// // // // // // // // // // // // // // // // // // // // // // //</span>
<span class="keywordtype">bool</span> acceptConnection(<a class="code" href="structDCSCom_1_1DCSServerInfo.html" title="Server info record.">DCSCom::DCSServerInfo</a>&amp; server,
                      <span class="keyword">const</span> <a class="code" href="classDCSTimeHeader.html" title="Time header class.">DCSTimeHeader</a>&amp; time,
                      <span class="keyword">const</span> <a class="code" href="classDCSScenarioHeader.html" title="Scenario header class.">DCSScenarioHeader</a>&amp; scenario,
                      <span class="keyword">const</span> <a class="code" href="classDCSHeaderContainer.html" title="A container class for storing header information.">DCSHeaderContainer</a>&amp; headers)
{
  <span class="comment">// In its simpleset form this function could merely be:</span>
  <span class="comment">// &#39;return DCSCom::serverNegotiate(DCSCom::serverAccept(server));&#39;</span>
  <span class="keywordtype">char</span> addr[DCS_ADDRSTRLEN];

  <span class="comment">// Accept the connection</span>
  SockClient* client = <a class="code" href="namespaceDCSCom.html#aff14db9d6f532bc7052d2c5325e9a1e3" title="Accept connections from clients.">DCSCom::serverAccept</a>(server);

  <span class="keywordflow">if</span> (client != NULL)
  {
    <span class="comment">// Report connection</span>
    std::stringstream sstr;
    sstr &lt;&lt; <span class="stringliteral">&quot;Accepted connection from &quot;</span> &lt;&lt; client-&gt;getAddress(addr, <span class="keyword">sizeof</span>(addr)) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; client-&gt;getPort() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(sstr.str().c_str());

    <span class="keywordflow">if</span> (!<a class="code" href="namespaceDCSCom.html#a73ab2ac527335014ce637148a8c73205" title="Negotiate a new client connection.">DCSCom::serverNegotiate</a>(server, client, time, scenario, headers))
    {
      logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(<span class="stringliteral">&quot;Client failed connection negotiation.\n&quot;</span>);
      <a class="code" href="namespaceDCSCom.html#a1ab2451561a6c5223d7d01d7c5797444" title="Terminate a client connection.">DCSCom::serverTerminateClient</a>(server, client);
      logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(<span class="stringliteral">&quot;Client was removed.\n&quot;</span>);
      <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
  }

  logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(<span class="stringliteral">&quot;Connection accept failed.\n&quot;</span>);
  <span class="keywordflow">return</span> <span class="keyword">false</span>;
}


<span class="comment">// // // // // // // // // // // // // // // // // // // // // // //</span>
<span class="comment">// Time in seconds since the beginning of the year</span>
<span class="keywordtype">double</span> yeartime()
{
  <span class="keyword">struct </span>timeval tp;

  <span class="comment">// get the current system time, using timezone value of 0</span>
  <span class="comment">// returns UTC time</span>
  gettimeofday(&amp;tp, 0);

  <span class="comment">// put system time into a tm struct</span>
  time_t t(tp.tv_sec);
  <span class="keyword">struct </span>tm* p_time = gmtime(&amp;t);

  <span class="comment">// assemble a UTC &quot;system time&quot;</span>
  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p_secs = (<span class="keywordtype">unsigned</span> int)(p_time-&gt;tm_sec )  +
    (((<span class="keywordtype">unsigned</span> int)(p_time-&gt;tm_min )) * 60) +
    (((<span class="keywordtype">unsigned</span> int)(p_time-&gt;tm_hour)) * 60*60) +
    (((<span class="keywordtype">unsigned</span> int)(p_time-&gt;tm_yday)) * 60*60*24);
  
  <span class="keywordflow">return</span> (p_secs + (tp.tv_usec * 1e-06));
}


<span class="comment">// // // // // // // // // // // // // // // // // // // // // // //</span>
<span class="comment">// simple dead-reckoning algorithm to generate points in an ENU</span>
<span class="comment">// topographic coordinate frame</span>
<span class="keywordtype">void</span> makeENUPosition(int32_t <span class="keywordtype">id</span>, <span class="keywordtype">double</span> time, <a class="code" href="structDCSPoint.html" title="A point class.">DCSPoint</a>&amp; enu, <a class="code" href="structDCSPoint.html" title="A point class.">DCSPoint</a>&amp; ori, <a class="code" href="structDCSPoint.html" title="A point class.">DCSPoint</a>&amp; vel)
{
  <span class="comment">// Generate sample position data</span>
  enu.<a class="code" href="structDCSPoint.html#a7cd38ba904cea2dfbe74d7cf279676c5" title="Portion of a three dimensional point.">x</a> = ((100 * (sin(time * 0.01)) + ((<span class="keywordtype">id</span> - 1) * 100)));
  enu.<a class="code" href="structDCSPoint.html#a8d667e58b5286b22808b77d9b2c762dc" title="Portion of a three dimensional point.">y</a> = ((100 * (cos(time * 0.01)) + ((<span class="keywordtype">id</span> - 1) * 100)));
  enu.<a class="code" href="structDCSPoint.html#a3b8b220207811f97b91a9aff31c6368e" title="Portion of a three dimensional point.">z</a> = 100;

  <span class="comment">// Generate sample orientation data</span>
  ori.<a class="code" href="structDCSPoint.html#a7cd38ba904cea2dfbe74d7cf279676c5" title="Portion of a three dimensional point.">x</a> = sin(ANGFIX((M_PI * .5) + (time * 0.1)));
  ori.<a class="code" href="structDCSPoint.html#a8d667e58b5286b22808b77d9b2c762dc" title="Portion of a three dimensional point.">y</a> = (<span class="keywordtype">id</span> == 4) ? 20.*DEG2RAD : 0.0;
  ori.<a class="code" href="structDCSPoint.html#a3b8b220207811f97b91a9aff31c6368e" title="Portion of a three dimensional point.">z</a> = (<span class="keywordtype">id</span> == 4) ? 15.*DEG2RAD : 0.0;

  <span class="comment">// Generate sample velocity data</span>
  vel.<a class="code" href="structDCSPoint.html#a7cd38ba904cea2dfbe74d7cf279676c5" title="Portion of a three dimensional point.">x</a> = (<span class="keywordtype">id</span> == 4) ? 1 : 0.0;
  vel.<a class="code" href="structDCSPoint.html#a8d667e58b5286b22808b77d9b2c762dc" title="Portion of a three dimensional point.">y</a> = (<span class="keywordtype">id</span> == 4) ? 2 : 0.0;
  vel.<a class="code" href="structDCSPoint.html#a3b8b220207811f97b91a9aff31c6368e" title="Portion of a three dimensional point.">z</a> = (<span class="keywordtype">id</span> == 4) ? 3 : 0.0;
}


<span class="comment">// // // // // // // // // // // // // // // // // // // // // // //</span>
<span class="comment">// Update DCS platform data</span>
<span class="keywordtype">void</span> updateData(int32_t <span class="keywordtype">id</span>, <span class="keywordtype">double</span> time, <a class="code" href="classDCSPlatformData.html" title="Platform data class.">DCSPlatformData</a>&amp; data)
{
  data.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a> = id;
  makeENUPosition(<span class="keywordtype">id</span>, time, data.<a class="code" href="classDCSPlatformData.html#a8a677df633f7b470df37b004005ee993" title="Object&#39;s position.">position_</a>, data.<a class="code" href="classDCSPlatformData.html#a35107d54cb9285fd085fe75b8773aff1" title="Object&#39;s orientation.">orientation_</a>, data.<a class="code" href="classDCSPlatformData.html#a60e67c243b136150ac7a8cb534762500" title="Object&#39;s velocity.">velocity_</a>);
  data.<a class="code" href="classDCSPlatformData.html#a7a0d63b418a13bb48b590d59f17a7901" title="Object&#39;s acceleration.">accel_</a>.<a class="code" href="structDCSPoint.html#a7e25b929b63e8305b6b6ab91e375aa3a">set</a>(4.0, 5.0, 6.0);
  data.<a class="code" href="classDCSPlatformData.html#a7c84f744e100e46aa3372ade0cd89b2e" title="Current time.">time_</a> = time;
}


<span class="comment">// // // // // // // // // // // // // // // // // // // // // // //</span>
<span class="comment">// Update DCS beam data</span>
<span class="keywordtype">void</span> updateData(int32_t <span class="keywordtype">id</span>, <span class="keywordtype">double</span> time, <a class="code" href="classDCSBeamData.html" title="Beam data class.">DCSBeamData</a>&amp; data)
{
  data.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a> = id;
  data.<a class="code" href="classDCSBeamData.html#a65f63d5e88698644ca23c51ae4103ac1" title="Current time.">time_</a> = time;
  data.<a class="code" href="classDCSBeamData.html#ab10c6dc4313870eaedfd7a2f8f405113" title="Azimuth.">azim_</a> = ANGFIX(time * DEG2RAD);
  data.<a class="code" href="classDCSBeamData.html#af93e12bd3be9d7149fe2596e6616dbaf" title="Elevation.">elev_</a> = 15.0 * DEG2RAD;
  data.<a class="code" href="classDCSBeamData.html#ab847f5e8d50a90fbce9aeb0a93a9d9c2" title="Length.">length_</a> = 300.0;
}


<span class="comment">// // // // // // // // // // // // // // // // // // // // // // //</span>
<span class="comment">// Update DCS gate data</span>
<span class="keywordtype">void</span> updateData(int32_t <span class="keywordtype">id</span>, <span class="keywordtype">double</span> time, <a class="code" href="classDCSGateData.html" title="Gate data class.">DCSGateData</a>&amp; data)
{
  data.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a> = id;
  data.<a class="code" href="classDCSGateData.html#a2c8225fb72d909619010352f23b94237" title="Current time.">time_</a> = time;
  data.<a class="code" href="classDCSGateData.html#a1013f155d72777056def5a58725f5a51" title="Azimuth.">azim_</a> = ANGFIX(time * DEG2RAD);
  data.<a class="code" href="classDCSGateData.html#a62984bac2c14c91a20f0dfb9867233ee" title="Elevation.">elev_</a> = 15.0 * DEG2RAD;
  data.<a class="code" href="classDCSGateData.html#a66e14ad4fcc27968770f790d08fb7b5e" title="Width.">width_</a> = 3.0 * DEG2RAD;
  data.<a class="code" href="classDCSGateData.html#aed0399b9f81ea238d708b6d3e5b0b9bc" title="Height.">height_</a> = 3.0 * DEG2RAD;
  data.<a class="code" href="classDCSGateData.html#a9aee5e0667ef3aeb3410e4f43e486563" title="Gate start distance.">minrange_</a> =  (<span class="keywordtype">id</span> == 24) ? -10. : 280.0;
  data.<a class="code" href="classDCSGateData.html#a9e5d3ae1fb224d0b53afe9024276192f" title="Gate end distance.">maxrange_</a> =  (<span class="keywordtype">id</span> == 24) ?  10. : 300.0;
  data.<a class="code" href="classDCSGateData.html#a5b24836a94000fce6c10cf3a8179d4f6" title="Gate centroid distance.">centroid_</a> =  (<span class="keywordtype">id</span> == 24) ?   0. : 290.0;
}


<span class="comment">// // // // // // // // // // // // // // // // // // // // // // //</span>
<span class="comment">// Creates the DCS headers for platforms</span>
<span class="keywordtype">void</span> makeDataSet(int32_t <span class="keywordtype">id</span>, <span class="keywordtype">double</span> time, <a class="code" href="classDCSPlatformData.html" title="Platform data class.">DCSPlatformData</a>&amp; data, <a class="code" href="classDCSPlatformHeader.html" title="Platform header class.">DCSPlatformHeader</a>&amp; header)
{
  updateData(<span class="keywordtype">id</span>, time, data);

  header.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a> = id;
  strncpy(header.<a class="code" href="classDCSPlatformHeader.html#a404be00b8555612def8b42519a9d4265" title="Object&#39;s associated icon name.">iconname_</a>, <span class="stringliteral">&quot;p-3c_orion_nrl&quot;</span>, <span class="keyword">sizeof</span>(header.<a class="code" href="classDCSPlatformHeader.html#a404be00b8555612def8b42519a9d4265" title="Object&#39;s associated icon name.">iconname_</a>)-1);
  std::stringstream sstr;
  sstr &lt;&lt; <span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot; p-3c_orion_nrl&quot;</span>;
  strncpy(header.<a class="code" href="classDCSPlatformHeader.html#aa174880dda1eac02b518bf1e70f13f7d" title="Object&#39;s callsign/name.">callsign_</a>, sstr.str().c_str(), <span class="keyword">sizeof</span>(header.<a class="code" href="classDCSPlatformHeader.html#aa174880dda1eac02b518bf1e70f13f7d" title="Object&#39;s callsign/name.">callsign_</a>)-1);
  header.<a class="code" href="classDCSPlatformHeader.html#a70598ab31feef64e38015c526f470ee6" title="Icon dimensions.">dims_</a>.<a class="code" href="structDCSPoint.html#a7e25b929b63e8305b6b6ab91e375aa3a">set</a>(0.0, 0.0, 0.0);
  <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == 6)
  {
    header.<a class="code" href="classDCSPlatformHeader.html#afa1ad8ec8944a5517c93779fd6f0f27d" title="Orientation offset.">orientationoffset_</a>.<a class="code" href="structDCSPoint.html#a7e25b929b63e8305b6b6ab91e375aa3a">set</a>(0.0, 30.0, 0.0);
    header.<a class="code" href="classDCSPlatformHeader.html#a05be4e741d68820438db45fcbdc17223" title="Offset from position.">offset_</a>.<a class="code" href="structDCSPoint.html#a7e25b929b63e8305b6b6ab91e375aa3a">set</a>(10.0, 0.0, 10.0);
  }
  <span class="keywordflow">else</span>
  {
    header.<a class="code" href="classDCSPlatformHeader.html#a05be4e741d68820438db45fcbdc17223" title="Offset from position.">offset_</a>.<a class="code" href="structDCSPoint.html#a7e25b929b63e8305b6b6ab91e375aa3a">set</a>(0.0, 0.0, 0.0);
    header.<a class="code" href="classDCSPlatformHeader.html#afa1ad8ec8944a5517c93779fd6f0f27d" title="Orientation offset.">orientationoffset_</a>.<a class="code" href="structDCSPoint.html#a7e25b929b63e8305b6b6ab91e375aa3a">set</a>(0.0, 0.0, 0.0);
  }
  header.<a class="code" href="classDCSPlatformHeader.html#af4ea373b289a82a300546bb91a9bde36" title="Coordinate system reference frame.">referenceframe_</a>.<a class="code" href="classDCSCoordReferenceFrame.html#a23c459336919b527c6212c31b27056d8" title="Latitude of topograhic origin.">latorigin_</a> = REFLAT;
  header.<a class="code" href="classDCSPlatformHeader.html#af4ea373b289a82a300546bb91a9bde36" title="Coordinate system reference frame.">referenceframe_</a>.<a class="code" href="classDCSCoordReferenceFrame.html#a3a2b7914d56875fe43ad6c529b2a951a" title="Longitude of topograhic origin.">lonorigin_</a> = REFLON;
  header.<a class="code" href="classDCSPlatformHeader.html#af4ea373b289a82a300546bb91a9bde36" title="Coordinate system reference frame.">referenceframe_</a>.<a class="code" href="classDCSCoordReferenceFrame.html#a24edd53eb3caaa3e3b016ea26a12d363" title="Object&#39;s local Coordinate System.">coordsystem_</a> = <a class="code" href="DCSdefs_8h.html#af707537cfdfcac94b52114141c4fcdf3acfd5ad6d1a641560a1793171a15a48ed">DCSCOORD_ENU</a>;
  header.<a class="code" href="classDCSPlatformHeader.html#a6991960adc703247cee5e9a89714e91e" title="Platform color.">color_</a> = 0;
  header.<a class="code" href="classDCSPlatformHeader.html#a44b6579c523c7b13c645e29638a2df47" title="Draw state.">state_</a> = <a class="code" href="DCSdefs_8h.html#a72495eb5a1c5a53d4cc991030eea7263a98130183664bfad054bab49ff810de15">DCSSTATE_ON</a>;
  header.<a class="code" href="classDCSPlatformHeader.html#a5509cece92c4a2eaf61a4de3439d07a2" title="Track quality.">status_</a> = <a class="code" href="DCSdefs_8h.html#a1a14127d294a92144cc56295e68c3e84a311a1aee155df9029362a0b844c2e6d3">DCSSTATUS_LIVE</a>;
  memcpy(&amp;header.<a class="code" href="classDCSPlatformHeader.html#a858b836b96958e2072088ebef6d9e2df" title="Current data value.">platdata_</a>, &amp;data, <span class="keyword">sizeof</span>(header.<a class="code" href="classDCSPlatformHeader.html#a858b836b96958e2072088ebef6d9e2df" title="Current data value.">platdata_</a>));
}


<span class="comment">// // // // // // // // // // // // // // // // // // // // // // //</span>
<span class="comment">// Creates the DCS headers for beams</span>
<span class="keywordtype">void</span> makeDataSet(int32_t <span class="keywordtype">id</span>, int32_t hostid, <span class="keywordtype">double</span> time, <a class="code" href="classDCSBeamData.html" title="Beam data class.">DCSBeamData</a>&amp; data, <a class="code" href="classDCSBeamHeader.html" title="Beam header class.">DCSBeamHeader</a>&amp; header)
{
  updateData(<span class="keywordtype">id</span>, time, data);

  header.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a> = id;
  std::stringstream sstr;
  sstr &lt;&lt; <span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot; p-3c_orion_nrl beam&quot;</span>;
  strncpy(header.<a class="code" href="classDCSBeamHeader.html#a0d0b23c32012efe521d8fa09be2f0fed" title="Beam&#39;s callsign/name.">callsign_</a>, sstr.str().c_str(), <span class="keyword">sizeof</span>(header.<a class="code" href="classDCSBeamHeader.html#a0d0b23c32012efe521d8fa09be2f0fed" title="Beam&#39;s callsign/name.">callsign_</a>)-1);
  header.<a class="code" href="classDCSBeamHeader.html#aa2585738c251a57361aed5fdfc60783e" title="Use a missile-type offset.">missileoffset_</a> = <span class="keyword">true</span>;
  header.<a class="code" href="classDCSBeamHeader.html#a2bacb64fbdf2bbae47050dad871f5a97" title="Position will be interpolated or not (defaults true)">interpolate_</a> = <span class="keyword">true</span>;
  header.<a class="code" href="classDCSBeamHeader.html#a203f7e60bd270f8afbcf562f53130835" title="Azimuth offset.">azimoffset_</a> = 0.0;
  header.<a class="code" href="classDCSBeamHeader.html#a8abce4db38148ad4fdfbeae47bb6191a" title="Elevation offset.">elevoffset_</a> = 0.0;
  header.<a class="code" href="classDCSBeamHeader.html#a180944e56330cf5e2265377e3707fcd8" title="Horizontal beam width.">hbw_</a> = 3 * DEG2RAD;
  header.<a class="code" href="classDCSBeamHeader.html#a5d2761881e703829e68706422571e971" title="Vertical beam width.">vbw_</a> = 3 * DEG2RAD;
  header.<a class="code" href="classDCSBeamHeader.html#a6a4bcce326af450f949f02d4d8219f88" title="Host platfrom id.">hostid_</a> = hostid;
  header.<a class="code" href="classDCSBeamHeader.html#a3c9fd4f3ab0e8d8ab9a663d1421b5a53" title="Beam color.">color_</a> = 0;
  header.<a class="code" href="classDCSBeamHeader.html#a3e9223d428b7cc65dfba1421d0693b8b" title="Draw state.">state_</a> = <a class="code" href="DCSdefs_8h.html#a72495eb5a1c5a53d4cc991030eea7263a98130183664bfad054bab49ff810de15">DCSSTATE_ON</a>;
  <span class="keywordflow">switch</span> (<span class="keywordtype">id</span>)
  {
    <span class="keywordflow">case</span> 14:
      header.<a class="code" href="classDCSBeamHeader.html#a4e17e9b48ce848725c8a8a0b8e847a08" title="Beam type.">beamtype_</a> = <a class="code" href="DCSdefs_8h.html#ac65e1ed2cac0b8d2d0346154aa094379a20c55ecca120f45a3026e4d3111a98bb">DCSBEAM_STEADY</a>;
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> 19:
      header.<a class="code" href="classDCSBeamHeader.html#a4e17e9b48ce848725c8a8a0b8e847a08" title="Beam type.">beamtype_</a> = <a class="code" href="DCSdefs_8h.html#ac65e1ed2cac0b8d2d0346154aa094379a2728630dd80bb606bf562379bb9bdd65">DCSBEAM_BODYAXIS</a>;
      <span class="keywordflow">break</span>;
    <span class="keywordflow">default</span>:
      header.<a class="code" href="classDCSBeamHeader.html#a4e17e9b48ce848725c8a8a0b8e847a08" title="Beam type.">beamtype_</a> = <a class="code" href="DCSdefs_8h.html#ac65e1ed2cac0b8d2d0346154aa094379a6c716b29e3b47bc22fab8d1bea88bdbc">DCSBEAM_LINEAR</a>;
      <span class="keywordflow">break</span>;
  }
  memcpy(&amp;header.<a class="code" href="classDCSBeamHeader.html#a5ea8db80b9194c51b84235d0bc719e45" title="Current data value.">beamdata_</a>, &amp;data, <span class="keyword">sizeof</span>(header.<a class="code" href="classDCSBeamHeader.html#a5ea8db80b9194c51b84235d0bc719e45" title="Current data value.">beamdata_</a>));
}


<span class="comment">// // // // // // // // // // // // // // // // // // // // // // //</span>
<span class="comment">// Creates the DCS headers for gates</span>
<span class="keywordtype">void</span> makeDataSet(int32_t <span class="keywordtype">id</span>, int32_t hostid, <span class="keywordtype">double</span> time, <a class="code" href="classDCSGateData.html" title="Gate data class.">DCSGateData</a>&amp; data, <a class="code" href="classDCSGateHeader.html" title="Gate header class.">DCSGateHeader</a>&amp; header)
{
  updateData(<span class="keywordtype">id</span>, time, data);

  header.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a> = id;
  std::stringstream sstr;
  sstr &lt;&lt; <span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot; p-3c_orion_nrl gate&quot;</span>;
  strncpy(header.<a class="code" href="classDCSGateHeader.html#a110af00d7a6e1653e3067e832acf90fe" title="Gate&#39;s callsign/name.">callsign_</a>, sstr.str().c_str(), <span class="keyword">sizeof</span>(header.<a class="code" href="classDCSGateHeader.html#a110af00d7a6e1653e3067e832acf90fe" title="Gate&#39;s callsign/name.">callsign_</a>)-1);
  header.<a class="code" href="classDCSGateHeader.html#a78ddca54288d50a134fe640595fad990" title="Gate offset.">offset_</a>.<a class="code" href="structDCSPoint.html#a7e25b929b63e8305b6b6ab91e375aa3a">set</a>(0.0, 0.0, 0.0);
  header.<a class="code" href="classDCSGateHeader.html#a3a24a9208dbe3faf28556b053267b58c" title="Azimuth offset.">azimoffset_</a> = 0.0;
  header.<a class="code" href="classDCSGateHeader.html#a7b421ae5fd7ebf739f3d1d50c99f106d" title="Elevation offset.">elevoffset_</a> = 0.0;
  header.<a class="code" href="classDCSGateHeader.html#a390ed1a267c0bbef4d79a0e5d1f609ed" title="Host beam id.">hostid_</a> = hostid;
  header.<a class="code" href="classDCSGateHeader.html#a05611a7e54a24a82b5c8e83c1b1cf822" title="Gate color.">color_</a> = 0;
  header.<a class="code" href="classDCSGateHeader.html#a764f4c0c100c7bfc8c1bc25aad14b78b" title="Draw state.">state_</a> = <a class="code" href="DCSdefs_8h.html#a72495eb5a1c5a53d4cc991030eea7263a98130183664bfad054bab49ff810de15">DCSSTATE_ON</a>;
  <span class="keywordflow">switch</span> (<span class="keywordtype">id</span>)
  {
    <span class="keywordflow">case</span> 24:
      header.<a class="code" href="classDCSGateHeader.html#a306103aa65a76260e8dc6fef63f9d72f" title="Gate type.">gatetype_</a> = <a class="code" href="DCSdefs_8h.html#a4d470476616e03eba5833f8a022f0722aa3b341862b034d56dd5bfe8a0e413655">DCSGATE_TARGET</a>;
      <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> 29:
      header.<a class="code" href="classDCSGateHeader.html#a306103aa65a76260e8dc6fef63f9d72f" title="Gate type.">gatetype_</a> = <a class="code" href="DCSdefs_8h.html#a4d470476616e03eba5833f8a022f0722a745f73b3d49d7527d076e5ca543c886e">DCSGATE_BODY</a>;
      <span class="keywordflow">break</span>;
    <span class="keywordflow">default</span>:
      header.<a class="code" href="classDCSGateHeader.html#a306103aa65a76260e8dc6fef63f9d72f" title="Gate type.">gatetype_</a> = <a class="code" href="DCSdefs_8h.html#a4d470476616e03eba5833f8a022f0722a8780f2cb3dcfdfc5183713ba7995c87b">DCSGATE_RANGE</a>;
      <span class="keywordflow">break</span>;
  }
  memcpy(&amp;header.<a class="code" href="classDCSGateHeader.html#a89c54a17e10755b1147520f6a04dfc7f" title="Current data value.">gatedata_</a>, &amp;data, <span class="keyword">sizeof</span>(header.<a class="code" href="classDCSGateHeader.html#a89c54a17e10755b1147520f6a04dfc7f" title="Current data value.">gatedata_</a>));
}


<span class="comment">// // // // // // // // // // // // // // // // // // // // // // //</span>
<span class="comment">// main program loop</span>
<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)
{
  <span class="comment">// The current platform id.  It will be incremented each time we create</span>
  <span class="comment">// a new platform in order to assign a unique id to each data set.</span>
  int32_t <span class="keywordtype">id</span> = 0;
  int32_t i = 0;
  int8_t datamode = DEFAULTMODE;
  std::stringstream sstr;
  <span class="keywordtype">char</span> addr[DCS_ADDRSTRLEN];
  <span class="keywordtype">bool</span> present=<span class="keyword">false</span>, success=<span class="keyword">false</span>;
  <span class="keywordtype">char</span> genericDataValue[256];
  <span class="keywordtype">double</span> toggleDuration = 4.0;
  <span class="keywordtype">bool</span> platformFourCreated = <span class="keyword">false</span>;
  <span class="keywordtype">int</span> drawModeCount = 0;

  <span class="comment">// Values for updating beam and gate states</span>
  <span class="keywordtype">double</span> lasttime = 0.0;
  <span class="keywordtype">bool</span> beamon = <span class="keyword">true</span>;
  int32_t coloroffset = 0;
  int32_t targetID = 1;

  <span class="comment">// Get current time &amp; year for scenario</span>
  time_t t = time(NULL);
  <span class="keyword">struct </span>tm* gmt = gmtime(&amp;t);
  <span class="keywordtype">int</span> currentYear = gmt-&gt;tm_year+1900;
  <span class="keywordtype">double</span> dtime = yeartime();

  <span class="comment">// remove old DCS database files</span>
  <span class="keywordtype">char</span> sysCmd[128];
<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>  strncpy(sysCmd,<span class="stringliteral">&quot;del dcsdb.dat&quot;</span>, <span class="keyword">sizeof</span>(sysCmd)-1);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>  strncpy(sysCmd,<span class="stringliteral">&quot;rm -f dcsdb.dat&quot;</span>, <span class="keyword">sizeof</span>(sysCmd)-1);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>  <span class="keywordtype">int</span> sysrv = system (sysCmd);
  

  <span class="comment">// Provides functionality for discovering new clients looking for a server</span>
  <a class="code" href="structDCSDisc_1_1DCSDiscover.html" title="DCS Server discovery class.">DCSDisc::DCSDiscover</a> discover;
  <span class="comment">// Stores information relevant to the actual DCS server</span>
  <a class="code" href="structDCSCom_1_1DCSServerInfo.html" title="Server info record.">DCSCom::DCSServerInfo</a> server;
  <span class="comment">// Provides functionality for inserting, updating, retrieving, and removing header objects</span>
  <a class="code" href="classDCSHeaderContainer.html" title="A container class for storing header information.">DCSHeaderContainer</a> headers;
  <span class="comment">// Provides updates for scenario wind speed and wind direction parameters.</span>
  <a class="code" href="classDCSScenarioData.html" title="Scenario data class.">DCSScenarioData</a> scendata(0.0, 0.0);
  <span class="comment">// Initialization parameters for scenario.  Specifies classification, reference coordinate, etc.</span>
  <a class="code" href="classDCSScenarioHeader.html" title="Scenario header class.">DCSScenarioHeader</a> scenheader(REFLAT, REFLON, currentYear, <a class="code" href="DCSdefs_8h.html#af707537cfdfcac94b52114141c4fcdf3acfd5ad6d1a641560a1793171a15a48ed">DCSCOORD_ENU</a>, <a class="code" href="DCSdefs_8h.html#a10b9fbd7c72c8917a66c2cb2404c08bfa3720d47aa6bb77b1737415b5d71f009e">DCSCLASS_UNCLASSIFIED</a>, scendata);
  <span class="comment">// Provides updates for time, if the server is acting as the time source.</span>
  <a class="code" href="classDCSTimeData.html" title="Time data class.">DCSTimeData</a> timedata(dtime);
  <span class="comment">// Initialization parameters for time.  Specifies time source (e.g. DCS server or client workstation&#39;s system clock)</span>
  <a class="code" href="classDCSTimeHeader.html" title="Time header class.">DCSTimeHeader</a> timeheader(1.0, <a class="code" href="DCSdefs_8h.html#a4c9a4aede0cb8f0a067fd61c2f8264d0a9f2489b04250e973c54304134ca43f77">DCSTIME_PACKET</a>, timedata);

  <span class="comment">// Initialization headers for all objects</span>
  <span class="comment">// Provides platform updates for position, orientation, velocity, and acceleration.</span>
  <a class="code" href="classDCSPlatformData.html" title="Platform data class.">DCSPlatformData</a> platdata;
  <span class="comment">// DCS container for a platform object.  Specifies call sign, 3D model to display, initial position, etc.</span>
  <a class="code" href="classDCSPlatformHeader.html" title="Platform header class.">DCSPlatformHeader</a> platheader;
  <span class="comment">// DCS container for a beam object.  Specifies associated platform, target, field of view, etc.</span>
  <a class="code" href="classDCSBeamHeader.html" title="Beam header class.">DCSBeamHeader</a> beamheader;
  <span class="comment">// DCS container for a gate object.  Specifies associated beam, width, length, etc.</span>
  <a class="code" href="classDCSGateHeader.html" title="Gate header class.">DCSGateHeader</a> gateheader;
  <span class="comment">// Modifies the state of a platform, beam, or gate object.  Changes color, beam target, etc.</span>
  <a class="code" href="classDCSEvent.html" title="Event class.">DCSEvent</a> event;

  <span class="comment">// First check command line args</span>
  <span class="keywordflow">if</span> (argc &gt; 1)
  {
    <span class="keywordflow">if</span> (argc &gt; 2 || strcmp(argv[1], <span class="stringliteral">&quot;-h&quot;</span>) == 0)
    {
      printf(<span class="stringliteral">&quot;Usage: %s [-h | -unicast | -broadcast | -multicast]\n&quot;</span>, argv[0]);
      <span class="keywordflow">return</span> 0;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[1], <span class="stringliteral">&quot;-unicast&quot;</span>) == 0)
      datamode = <a class="code" href="DCSdefs_8h.html#a8f662097696a06425380ceaec3900b05a46e1c2f4219add89da21744a6b125fe3">DCSDATA_UNICAST</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[1], <span class="stringliteral">&quot;-broadcast&quot;</span>) == 0)
      datamode = <a class="code" href="DCSdefs_8h.html#a8f662097696a06425380ceaec3900b05aedc3c9c4a6e599c8df83b48c841b9fc9">DCSDATA_BROADCAST</a>;
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[1], <span class="stringliteral">&quot;-multicast&quot;</span>) == 0)
      datamode = <a class="code" href="DCSdefs_8h.html#a8f662097696a06425380ceaec3900b05a109d67eee74810df5291fa5623eb1cc6">DCSDATA_MULTICAST</a>;
    <span class="keywordflow">else</span>
    {
      printf(<span class="stringliteral">&quot;Usage: %s [-h | -unicast | -broadcast | -multicast]\n&quot;</span>, argv[0]);
      <span class="keywordflow">return</span> 0;
    }
  }

  <span class="comment">// In order to properly stop the server, we set a signal handler that</span>
  <span class="comment">// allows the user to stop the process by pressing Ctl C.</span>
<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>  <span class="comment">// PC windows only</span>
  signal(SIGINT, (<span class="keywordtype">void</span>(*)(int32_t))serverInterrupt);
  cout &lt;&lt; <span class="stringliteral">&quot;\n\t   Press Q key to quit DCS Server\n&quot;</span> &lt;&lt; endl;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>  <span class="comment">// all others</span>
  cout &lt;&lt; <span class="stringliteral">&quot;\n\t Press Ctl-C key to quit DCS Server\n&quot;</span> &lt;&lt; endl;
  <span class="keyword">struct </span>sigaction act;
  act.sa_handler = (void(*)(int32_t))serverInterrupt;
  sigemptyset(&amp;act.sa_mask);
  act.sa_flags = 0;
<span class="preprocessor">#ifdef SA_RESTART</span>
<span class="preprocessor"></span>  act.sa_flags |= SA_RESTART;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>  sigaction(SIGINT, &amp;act, NULL);
  
  <span class="comment">// Ignore SIGPIPE which will cause an exit when</span>
  <span class="comment">// reading from a broken socket more than once.</span>
  <span class="comment">// This only affects UNIX machines, Sun &amp; Linux in particular</span>
  signal(SIGPIPE, SIG_IGN);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <span class="comment">// reload DCS database file (if file exists)</span>
  <span class="keywordflow">if</span> (headers.<a class="code" href="classDCSHeaderContainer.html#a2590713cfc6c8c1cd198d296ac8e581f" title="Restore the DCSHeaderContainer from a file.">restore</a>(<span class="stringliteral">&quot;dcsdb.dat&quot;</span>))
  {
    <span class="keywordtype">id</span> = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(headers.<a class="code" href="classDCSHeaderContainer.html#a95a861e3660e883687b54ef312d74c66" title="Indicates size of the DCSHeaderContainer.">size</a>()/3);
    sstr.str(<span class="stringliteral">&quot;&quot;</span>);
    sstr &lt;&lt; <span class="stringliteral">&quot;Loaded &quot;</span> &lt;&lt; headers.<a class="code" href="classDCSHeaderContainer.html#a95a861e3660e883687b54ef312d74c66" title="Indicates size of the DCSHeaderContainer.">size</a>() &lt;&lt; <span class="stringliteral">&quot;platforms from file\n&quot;</span>;
    logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(sstr.str().c_str());
  }
  <span class="keywordflow">else</span>
  {
    logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(<span class="stringliteral">&quot;Failed to restore file.  Starting a new one.\n&quot;</span>);
    headers.<a class="code" href="classDCSHeaderContainer.html#a47a23ca4cce296c9af67888d28dcc7a0" title="Intialize the DCSHeaderContainer.">initialize</a>(<span class="stringliteral">&quot;dcsdb.dat&quot;</span>);
  }

  <span class="comment">// Delete &#39;dcsdb.dat&#39; on successful exit.</span>
  headers.<a class="code" href="classDCSHeaderContainer.html#ad10c137b4eabaa0f3d336b2dab201ade" title="Specify that the random access file should be preserved on exit.">setSave</a>(<span class="keyword">false</span>);

  <span class="comment">// Socket initialization status, For the PC, this function calls the</span>
  <span class="comment">// WSAStartup function, which must be the first Windows Sockets function</span>
  <span class="comment">// called by an application or DLL. It allows an application or DLL</span>
  <span class="comment">// to specify the version of Windows Sockets required and to retrieve</span>
  <span class="comment">// details of the specific Windows Sockets implementation. The application</span>
  <span class="comment">// or DLL can only issue further Windows Sockets functions after</span>
  <span class="comment">// successfully calling WSAStartup.</span>
  <span class="keywordflow">if</span> (!initializeSocket())
  {
    <span class="keywordtype">char</span> errormsg[256];
    getSockErrString(errormsg, 256);
    logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(<span class="stringliteral">&quot;Error initializing socket\n&quot;</span>);
    logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(<span class="stringliteral">&quot;System error message: &quot;</span>);
    logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(errormsg);
    logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(<span class="stringliteral">&quot;\n&quot;</span>);
    <span class="keywordflow">return</span> 0;
  }

  <span class="comment">// Initialize our dynamic client discovery socket</span>
  <span class="comment">// The discovery deamon needs to know the IP address and port that</span>
  <span class="comment">// this server can be reached through.  For this example we are using</span>
  <span class="comment">// port 2525.  The IP address that is specified for this server can be set</span>
  <span class="comment">// by picking an outgoing interface.  It only makes sense to report that our server</span>
  <span class="comment">// can be accessed through the only interface it is listening on.  For this example, if the interface is</span>
  <span class="comment">// NULL (no interface is specified so the kernel will listen on all available</span>
  <span class="comment">// network interfaces) we will use the address of a network interface obtained through gethostbyname.</span>
  <span class="comment">// In most cases you would probably specify the host address directly, rather</span>
  <span class="comment">// than querying for it via gethostbyname.</span>
  <span class="keywordflow">if</span> (IFACE == NULL)
  {
    <span class="keywordtype">char</span> hostname[512];

    strncpy(addr, <span class="stringliteral">&quot;127.0.0.1&quot;</span>, <span class="keyword">sizeof</span>(addr)-1);
    <span class="keywordflow">if</span> (gethostname(hostname, <span class="keyword">sizeof</span>(hostname))!= SOCKET_ERROR)
    {
      <span class="keyword">struct </span>hostent *hptr = gethostbyname(hostname);
      <span class="keywordflow">if</span> (hptr != NULL&amp;&amp;*hptr-&gt;h_addr_list != NULL)
      {
        <span class="keyword">struct </span>in_addr in;
        memcpy(&amp;in.s_addr, *hptr-&gt;h_addr_list, 4);
        strncpy(addr, inet_ntoa(in), <span class="keyword">sizeof</span>(addr)-1);
      }
    }
    printf(<span class="stringliteral">&quot;Will tell clients to connect to %s 2525\n&quot;</span>, addr);
    <span class="keywordflow">if</span>(!DCSDisc::discoverServInit(discover, 2525, addr, <span class="stringliteral">&quot;Test server&quot;</span>, 1, IFACE))
    {
      <span class="keywordtype">char</span> errormsg[256];
      sstr.str(<span class="stringliteral">&quot;&quot;</span>);
      sstr &lt;&lt; <span class="stringliteral">&quot;Error initializing multicast socket for client management: &quot;</span> &lt;&lt; getSockErr() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
      logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(sstr.str().c_str());

      getSockErrString(errormsg, 256);
      logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(<span class="stringliteral">&quot;System error message: &quot;</span>);
      logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(errormsg);
      logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(<span class="stringliteral">&quot;\n&quot;</span>);
      <span class="keywordflow">return</span> 0;
    }
  }
  <span class="keywordflow">else</span>
  {
    <span class="keywordflow">if</span>(!DCSDisc::discoverServInit(discover, 2525, IFACE, <span class="stringliteral">&quot;Test server&quot;</span>, 1, IFACE))
    {
      <span class="keywordtype">char</span> errormsg[256];
      sstr.str(<span class="stringliteral">&quot;&quot;</span>);
      sstr &lt;&lt; <span class="stringliteral">&quot;Error initializing multicast socket for client management: &quot;</span> &lt;&lt; getSockErr() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
      logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(sstr.str().c_str());

      getSockErrString(errormsg, 256);
      logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(<span class="stringliteral">&quot;System error message: &quot;</span>);
      logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(errormsg);
      logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(<span class="stringliteral">&quot;\n&quot;</span>);
      <span class="keywordflow">return</span> 0;
    }
  }

  <span class="comment">// Initialize the DCS server - defaults to multicast</span>
  <span class="keywordflow">if</span> (datamode == <a class="code" href="DCSdefs_8h.html#a8f662097696a06425380ceaec3900b05a46e1c2f4219add89da21744a6b125fe3">DCSDATA_UNICAST</a>)
  {
    success = <a class="code" href="namespaceDCSCom.html#a3ecba855f2f7f94c9629dee0c44c9729" title="Server creation/initialization.">DCSCom::serverStart</a>(server, 2525, <a class="code" href="DCSdefs_8h.html#a8f662097696a06425380ceaec3900b05a46e1c2f4219add89da21744a6b125fe3">DCSDATA_UNICAST</a>, 2020, NULL, IFACE);
    <span class="keywordflow">if</span> (success)
      cout &lt;&lt; <span class="stringliteral">&quot;DCS Server Protocol: UNICAST&quot;</span> &lt;&lt; endl;
  }
  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datamode == <a class="code" href="DCSdefs_8h.html#a8f662097696a06425380ceaec3900b05aedc3c9c4a6e599c8df83b48c841b9fc9">DCSDATA_BROADCAST</a>)
  {
    success = <a class="code" href="namespaceDCSCom.html#a3ecba855f2f7f94c9629dee0c44c9729" title="Server creation/initialization.">DCSCom::serverStart</a>(server, 2525, <a class="code" href="DCSdefs_8h.html#a8f662097696a06425380ceaec3900b05aedc3c9c4a6e599c8df83b48c841b9fc9">DCSDATA_BROADCAST</a>, 2020, <span class="stringliteral">&quot;255.255.255.255&quot;</span>, IFACE);
    <span class="keywordflow">if</span> (success)
      cout &lt;&lt; <span class="stringliteral">&quot;DCS Server Protocol: BROADCAST&quot;</span> &lt;&lt; endl;
  }
  <span class="keywordflow">else</span>
  {
    success = <a class="code" href="namespaceDCSCom.html#a3ecba855f2f7f94c9629dee0c44c9729" title="Server creation/initialization.">DCSCom::serverStart</a>(server, 2525, <a class="code" href="DCSdefs_8h.html#a8f662097696a06425380ceaec3900b05a109d67eee74810df5291fa5623eb1cc6">DCSDATA_MULTICAST</a>, 2020, <span class="stringliteral">&quot;227.0.20.20&quot;</span>, IFACE);
    <span class="keywordflow">if</span> (success)
      cout &lt;&lt; <span class="stringliteral">&quot;DCS Server Protocol: MULTICAST&quot;</span> &lt;&lt; endl;
  }

  <span class="comment">// if not successful, then clean up allocated resources</span>
  <span class="keywordflow">if</span> (!success)
  {
    <span class="keywordtype">char</span> errormsg[256];
    sstr.str(<span class="stringliteral">&quot;&quot;</span>);
    sstr &lt;&lt; <span class="stringliteral">&quot;Error starting server: &quot;</span> &lt;&lt; server.<a class="code" href="structDCSCom_1_1DCSServerInfo.html#a51fd1249b1f6262ca25992046956b217" title="TCP server socket.">servsock</a>-&gt;getLastError() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(sstr.str().c_str());

    getSockErrString(errormsg, 256);
    logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(<span class="stringliteral">&quot;System error message: &quot;</span>);
    logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(errormsg);
    logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(<span class="stringliteral">&quot;\n&quot;</span>);

    DCSDisc::discoverFree(discover);
    finalizeSocket();
    <span class="keywordflow">return</span> 0;
  }

<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>  logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(<span class="stringliteral">&quot;Starting server.  Use Q to kill.\n&quot;</span>);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>  logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(<span class="stringliteral">&quot;Starting server.  Use Ctl C to kill.\n&quot;</span>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <span class="comment">// main loop, data is created and sent via DCS until a Ctl C is</span>
  <span class="comment">// issued by the user</span>
  cout.precision(12);
  <span class="keywordflow">while</span> (running)
  {
    <span class="comment">// See if any clients are looking for a server.</span>
    <span class="comment">// If they are, announce our IP address and port</span>
    <span class="keywordflow">if</span> (discover.<a class="code" href="structDCSDisc_1_1DCSDiscover.html#a192c35d9633708729c9bab29d279e205">request</a>-&gt;readReady())
    {
      DCSDisc::discoverRespond(discover);
    }

    <span class="comment">// Will wait at least 100 milliseconds for new connection test</span>
    <span class="comment">// This should give us a default 10Hz data update rate</span>
    <span class="keywordflow">if</span> (server.<a class="code" href="structDCSCom_1_1DCSServerInfo.html#a51fd1249b1f6262ca25992046956b217" title="TCP server socket.">servsock</a>-&gt;readReady(0, DELAY))
    {
      acceptConnection(server, timeheader, scenheader, headers);
    }

    <span class="comment">// Get our data here.  The data can come from any source such as</span>
    <span class="comment">// The network or a file.  In this example it is made up.</span>
    dtime = yeartime();
    timedata.time_ = dtime;
    timeheader.timedata_.time_ = dtime;

    <span class="comment">// Send time</span>
    <a class="code" href="namespaceDCSCom.html#a05235a41949dad41a7622fe5a6f16482" title="Send time data to the client.">DCSCom::sendTimeData</a>(server, &amp;timedata);

    <span class="comment">// add a new data set every few seconds until the max number is defined</span>
    time_t test = time(NULL)-t;
    <span class="keywordflow">if</span> ((headers.<a class="code" href="classDCSHeaderContainer.html#a95a861e3660e883687b54ef312d74c66" title="Indicates size of the DCSHeaderContainer.">size</a>() &lt; (MAXPLAT*3)) &amp;&amp; (test/PLATTIME) &gt; (<span class="keywordtype">id</span>-1))
    {
      makeDataSet(++<span class="keywordtype">id</span>, dtime, platdata, platheader);
      makeDataSet(<span class="keywordtype">id</span>+MAXPLAT, <span class="keywordtype">id</span>, dtime, beamheader.<a class="code" href="classDCSBeamHeader.html#a5ea8db80b9194c51b84235d0bc719e45" title="Current data value.">beamdata_</a>, beamheader);
      makeDataSet(<span class="keywordtype">id</span>+(MAXPLAT*2), <span class="keywordtype">id</span>+MAXPLAT, dtime, gateheader.<a class="code" href="classDCSGateHeader.html#a89c54a17e10755b1147520f6a04dfc7f" title="Current data value.">gatedata_</a>, gateheader);

      <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == 4)
      {
        <span class="comment">// Set the beam&#39;s target id for the steady (target) beam type.</span>
        beamheader.<a class="code" href="classDCSBeamHeader.html#ab477729aa31874358f5628bd714c861a" title="Target platform id.">targetid_</a> = targetID;
      }
      <span class="keywordflow">else</span>
      {
        <span class="comment">// Otherwise, for non-steady type beams, set the targetid to the no-target state</span>
        beamheader.<a class="code" href="classDCSBeamHeader.html#ab477729aa31874358f5628bd714c861a" title="Target platform id.">targetid_</a> = -1;
      }

      <span class="comment">// Update our database and clients</span>
      <span class="comment">// We don&#39;t really need to test &#39;present&#39; but this illustrates how it&#39;s to be used.</span>
      <span class="keywordflow">if</span> (headers.<a class="code" href="classDCSHeaderContainer.html#a8379a68452379d075d2166253171d2c0" title="Update an existing header.">update</a>(&amp;platheader, present))
      {
        sstr.str(<span class="stringliteral">&quot;&quot;</span>);
        sstr &lt;&lt; <span class="stringliteral">&quot;Added platform &quot;</span> &lt;&lt; DCS::uint64totext(platheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
      }
      <span class="keywordflow">else</span>
      {
        sstr.str(<span class="stringliteral">&quot;&quot;</span>);
        sstr &lt;&lt; <span class="stringliteral">&quot;Failed to add platform &quot;</span> &lt;&lt; DCS::uint64totext(platheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
      }
      logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(sstr.str().c_str());
      
      <span class="keywordflow">if</span> (!present)
      {
        <a class="code" href="namespaceDCSCom.html#a82cba60f64a5c3b947549cb821dfdf4c" title="Send a platform header to the client.">DCSCom::sendPlatformHeader</a>(server, &amp;platheader);
        <a class="code" href="namespaceDCSCom.html#ad1e039e495ae7198693217c7c4425697" title="Send generic data to the client.">DCSCom::sendCategoryData</a> (server, platheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>, platheader.<a class="code" href="classDCSPlatformHeader.html#a858b836b96958e2072088ebef6d9e2df" title="Current data value.">platdata_</a>.<a class="code" href="classDCSPlatformData.html#a7c84f744e100e46aa3372ade0cd89b2e" title="Current time.">time_</a>, DCS::getCategoryName (<a class="code" href="DCSdefs_8h.html#a37d8201ec932256ff86b0377b05b97ccacb0f8524984ea8f187fcf9954d5851ac">DCSALLEGIENCE_FRIENDLY</a>), DCS::getCategoryValue (<a class="code" href="DCSdefs_8h.html#a37d8201ec932256ff86b0377b05b97ccacb0f8524984ea8f187fcf9954d5851ac">DCSALLEGIENCE_FRIENDLY</a>));
        <a class="code" href="namespaceDCSCom.html#ad1e039e495ae7198693217c7c4425697" title="Send generic data to the client.">DCSCom::sendCategoryData</a> (server, platheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>, platheader.<a class="code" href="classDCSPlatformHeader.html#a858b836b96958e2072088ebef6d9e2df" title="Current data value.">platdata_</a>.<a class="code" href="classDCSPlatformData.html#a7c84f744e100e46aa3372ade0cd89b2e" title="Current time.">time_</a>, DCS::getCategoryName (<a class="code" href="DCSdefs_8h.html#a714395f3b145bf5e2d8533872e791d11a108b3d3001ce35fe3657286fe29d09e2">DCSPLATFORM_AIRCRAFT</a>), DCS::getCategoryValue (<a class="code" href="DCSdefs_8h.html#a714395f3b145bf5e2d8533872e791d11a108b3d3001ce35fe3657286fe29d09e2">DCSPLATFORM_AIRCRAFT</a>));
      }

      <span class="keywordflow">if</span> (headers.<a class="code" href="classDCSHeaderContainer.html#a8379a68452379d075d2166253171d2c0" title="Update an existing header.">update</a>(&amp;beamheader, present))
      {
        sstr.str(<span class="stringliteral">&quot;&quot;</span>);
        sstr &lt;&lt; <span class="stringliteral">&quot;Added beam &quot;</span> &lt;&lt; DCS::uint64totext(beamheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
      }
      <span class="keywordflow">else</span>
      {
        sstr.str(<span class="stringliteral">&quot;&quot;</span>);
        sstr &lt;&lt; <span class="stringliteral">&quot;Failed to add beam &quot;</span> &lt;&lt; DCS::uint64totext(beamheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
      }
      logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(sstr.str().c_str());
      
      <span class="keywordflow">if</span> (!present)
      {
        <a class="code" href="namespaceDCSCom.html#ab0b288181dd1dea4aea7fac461f64faa" title="Send a beam header to the client.">DCSCom::sendBeamHeader</a>(server, &amp;beamheader);
      }

      <span class="keywordflow">if</span> (headers.<a class="code" href="classDCSHeaderContainer.html#a8379a68452379d075d2166253171d2c0" title="Update an existing header.">update</a>(&amp;gateheader, present))
      {
        sstr.str(<span class="stringliteral">&quot;&quot;</span>);
        sstr &lt;&lt; <span class="stringliteral">&quot;Added gate &quot;</span> &lt;&lt; DCS::uint64totext(gateheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
      }
      <span class="keywordflow">else</span>
      {
        sstr.str(<span class="stringliteral">&quot;&quot;</span>);
        sstr &lt;&lt; <span class="stringliteral">&quot;Failed to add gate &quot;</span> &lt;&lt; DCS::uint64totext(gateheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
      }
      logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(sstr.str().c_str());
      
      <span class="keywordflow">if</span> (!present)
      {
        <a class="code" href="namespaceDCSCom.html#abde5cf53d55d8425a25d2e7f4afecc67" title="Send a gate header to the client.">DCSCom::sendGateHeader</a>(server, &amp;gateheader);
      }
    }

    <span class="comment">// Update our data positions</span>
    <span class="keywordflow">for</span> (i = 1; i &lt;= id; i++)
    {
      makeDataSet(i, dtime, platdata, platheader);
      makeDataSet(i+MAXPLAT, i, dtime, beamheader.<a class="code" href="classDCSBeamHeader.html#a5ea8db80b9194c51b84235d0bc719e45" title="Current data value.">beamdata_</a>, beamheader);
      makeDataSet(i+(MAXPLAT*2), i+MAXPLAT, dtime, gateheader.<a class="code" href="classDCSGateHeader.html#a89c54a17e10755b1147520f6a04dfc7f" title="Current data value.">gatedata_</a>, gateheader);

      <span class="keywordflow">if</span> (i == 4)
      {
        <span class="comment">// Set the beam&#39;s target id for the steady (target) beam type.</span>
        beamheader.<a class="code" href="classDCSBeamHeader.html#ab477729aa31874358f5628bd714c861a" title="Target platform id.">targetid_</a> = targetID;
        platformFourCreated = <span class="keyword">true</span>;
      }
      <span class="keywordflow">else</span>
      {
        <span class="comment">// Otherwise, for non-steady type beams, set the targetid to the no-target state</span>
        beamheader.<a class="code" href="classDCSBeamHeader.html#ab477729aa31874358f5628bd714c861a" title="Target platform id.">targetid_</a> = -1;
      }

      <span class="comment">// Send data to clients</span>
      <a class="code" href="namespaceDCSCom.html#ae943d41ff26433146d93aabf9234502f" title="Send platform data to the client.">DCSCom::sendPlatformData</a>(server, &amp;platdata);
      <a class="code" href="namespaceDCSCom.html#a2f4f800adb6f3b93bca11d6a1aa0a472" title="Send beam data to the client.">DCSCom::sendBeamData</a>(server, &amp;beamheader.<a class="code" href="classDCSBeamHeader.html#a5ea8db80b9194c51b84235d0bc719e45" title="Current data value.">beamdata_</a>);
      <a class="code" href="namespaceDCSCom.html#a01113e787b6a096870b834e2268210d8" title="Send gate data to the client.">DCSCom::sendGateData</a>(server, &amp;gateheader.<a class="code" href="classDCSGateHeader.html#a89c54a17e10755b1147520f6a04dfc7f" title="Current data value.">gatedata_</a>);

      <span class="comment">// Send generic data to clients</span>
      memset(genericDataValue, 0, <span class="keyword">sizeof</span>(genericDataValue));
      strncpy(genericDataValue, <span class="stringliteral">&quot;Value&quot;</span>, <span class="keyword">sizeof</span>(genericDataValue)-1);
      <a class="code" href="namespaceDCSCom.html#a2ddec14211b9c222d019cadd51c973e3" title="Send generic data to the client.">DCSCom::sendGenericData</a>(server, platheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>, dtime, -1, <span class="stringliteral">&quot;Tag&quot;</span>, genericDataValue);
      <a class="code" href="namespaceDCSCom.html#a2ddec14211b9c222d019cadd51c973e3" title="Send generic data to the client.">DCSCom::sendGenericData</a>(server, beamheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>, dtime, -1, <span class="stringliteral">&quot;Tag&quot;</span>, genericDataValue);
      <a class="code" href="namespaceDCSCom.html#a2ddec14211b9c222d019cadd51c973e3" title="Send generic data to the client.">DCSCom::sendGenericData</a>(server, gateheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>, dtime, -1, <span class="stringliteral">&quot;Tag&quot;</span>, genericDataValue);

      <span class="comment">// Send category data to clients</span>
      memset(genericDataValue, 0, <span class="keyword">sizeof</span>(genericDataValue));
      strncpy(genericDataValue, <span class="stringliteral">&quot;Value&quot;</span>, <span class="keyword">sizeof</span>(genericDataValue)-1);
      <a class="code" href="classDCSCategoryData.html" title="Category data class.">DCSCategoryData</a> catData(platheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>, dtime, <span class="stringliteral">&quot;Name&quot;</span>, genericDataValue);
      <a class="code" href="namespaceDCSCom.html#a6cd751665075cee8ed3e69c843b848a6" title="Send data to the client via TCP.">DCSCom::sendTCPData</a>(server, <a class="code" href="DCSdefs_8h.html#a86381a2e8897f8ef0dc706fd4e79e1b5af255ca257ec48a21495eeab6b96f0833">DCSREQUEST_HEADER</a>, &amp;catData);
      catData.id_ = beamheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>;
      <a class="code" href="namespaceDCSCom.html#a6cd751665075cee8ed3e69c843b848a6" title="Send data to the client via TCP.">DCSCom::sendTCPData</a>(server, <a class="code" href="DCSdefs_8h.html#a86381a2e8897f8ef0dc706fd4e79e1b5af255ca257ec48a21495eeab6b96f0833">DCSREQUEST_HEADER</a>, &amp;catData);
      catData.id_ = gateheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>;
      <a class="code" href="namespaceDCSCom.html#a6cd751665075cee8ed3e69c843b848a6" title="Send data to the client via TCP.">DCSCom::sendTCPData</a>(server, <a class="code" href="DCSdefs_8h.html#a86381a2e8897f8ef0dc706fd4e79e1b5af255ca257ec48a21495eeab6b96f0833">DCSREQUEST_HEADER</a>, &amp;catData);

      <span class="comment">// Now update beam and gate states, and change the colors</span>
      <span class="keywordflow">if</span> (dtime-lasttime &gt; toggleDuration)
      {
        <span class="keyword">event</span>.time_ = dtime;

        <span class="comment">// We&#39;ll need to update this change in the database.</span>
        beamheader.<a class="code" href="classDCSBeamHeader.html#a3e9223d428b7cc65dfba1421d0693b8b" title="Draw state.">state_</a> = (beamon) ? <a class="code" href="DCSdefs_8h.html#a72495eb5a1c5a53d4cc991030eea7263a98130183664bfad054bab49ff810de15">DCSSTATE_ON</a> : <a class="code" href="DCSdefs_8h.html#a72495eb5a1c5a53d4cc991030eea7263aabf25a45a76afcc967e300675b378116">DCSSTATE_OFF</a>;
        gateheader.<a class="code" href="classDCSGateHeader.html#a764f4c0c100c7bfc8c1bc25aad14b78b" title="Draw state.">state_</a> = (beamon) ? <a class="code" href="DCSdefs_8h.html#a72495eb5a1c5a53d4cc991030eea7263a98130183664bfad054bab49ff810de15">DCSSTATE_ON</a> : <a class="code" href="DCSdefs_8h.html#a72495eb5a1c5a53d4cc991030eea7263aabf25a45a76afcc967e300675b378116">DCSSTATE_OFF</a>;

        beamheader.<a class="code" href="classDCSBeamHeader.html#a3c9fd4f3ab0e8d8ab9a663d1421b5a53" title="Beam color.">color_</a> = bcolors[(i+coloroffset)%10];
        gateheader.<a class="code" href="classDCSGateHeader.html#a05611a7e54a24a82b5c8e83c1b1cf822" title="Gate color.">color_</a> = gcolors[(i+coloroffset)%10];

        <span class="comment">// Now send the new event.</span>
        <span class="keyword">event</span>.data_ = (beamon) ? <a class="code" href="DCSdefs_8h.html#a72495eb5a1c5a53d4cc991030eea7263a98130183664bfad054bab49ff810de15">DCSSTATE_ON</a> : <a class="code" href="DCSdefs_8h.html#a72495eb5a1c5a53d4cc991030eea7263aabf25a45a76afcc967e300675b378116">DCSSTATE_OFF</a>;
        <span class="keyword">event</span>.eventtype_ = <a class="code" href="DCSdefs_8h.html#a7e76885674c4cd3e17cf421fff646c78aa54ac4a7fb6d5fc24b77220704100e13">DCSEVENT_STATE</a>;

        <span class="keyword">event</span>.id_ = beamheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>;
        <a class="code" href="namespaceDCSCom.html#a3ce08f8cc5cfba107338024f891bf626" title="Send an event to the client.">DCSCom::sendEvent</a>(server, &amp;event);

        <span class="keyword">event</span>.id_ = gateheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>;
        <a class="code" href="namespaceDCSCom.html#a3ce08f8cc5cfba107338024f891bf626" title="Send an event to the client.">DCSCom::sendEvent</a>(server, &amp;event);

        <span class="comment">// Do not update if we know beams are not displayed</span>
        <span class="keywordflow">if</span> (beamon)
        {
          <span class="comment">// Color events</span>
          <span class="keyword">event</span>.eventtype_ = <a class="code" href="DCSdefs_8h.html#a7e76885674c4cd3e17cf421fff646c78a37083f6ac452ab698e5b34de428f2389">DCSEVENT_COLOR</a>;

          <span class="keyword">event</span>.id_ = beamheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>;
          <span class="keyword">event</span>.data_ = (int32_t)beamheader.<a class="code" href="classDCSBeamHeader.html#a3c9fd4f3ab0e8d8ab9a663d1421b5a53" title="Beam color.">color_</a>;
          <a class="code" href="namespaceDCSCom.html#a3ce08f8cc5cfba107338024f891bf626" title="Send an event to the client.">DCSCom::sendEvent</a>(server, &amp;event);

          <span class="keyword">event</span>.id_ = gateheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>;
          <span class="keyword">event</span>.data_ = (int32_t)gateheader.<a class="code" href="classDCSGateHeader.html#a05611a7e54a24a82b5c8e83c1b1cf822" title="Gate color.">color_</a>;
          <a class="code" href="namespaceDCSCom.html#a3ce08f8cc5cfba107338024f891bf626" title="Send an event to the client.">DCSCom::sendEvent</a>(server, &amp;event);

          <span class="comment">// Send beam target event.  Since this is an event, the data transport is</span>
          <span class="comment">// TCP, thus all clients will reliably receive the beam target event.</span>
          <span class="comment">// In this example, we are &#39;targeting&#39; the beam (i.e. radar) to a specific platform</span>
          <span class="comment">// instead of sending range, azimuth and elevation, the platform&#39;s ID value is used.</span>
          <span class="comment">// The range, azimuth and elevation values for the beam are automatically calculated</span>
          <span class="comment">// within SIMDIS</span>
          <span class="comment">// As an example, cycle through all available &#39;targets&#39;</span>
          <span class="keywordflow">if</span> (i == 4)
          {
            <span class="keyword">event</span>.eventtype_ = <a class="code" href="DCSdefs_8h.html#a7e76885674c4cd3e17cf421fff646c78a5291f1ff965ddede74bbf83bc70e3bbd">DCSEVENT_TARGETID</a>;
            <span class="keyword">event</span>.id_ = beamheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>;
            ++targetID;
            <span class="comment">// prevent platform 4 from tracking itself</span>
            <span class="keywordflow">if</span> (targetID == 4)
            {
              targetID = 5;
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (targetID &gt; 10)
            {
              targetID = 1;
            }
            <span class="keyword">event</span>.data_ = targetID;

            <a class="code" href="namespaceDCSCom.html#a3ce08f8cc5cfba107338024f891bf626" title="Send an event to the client.">DCSCom::sendEvent</a>(server, &amp;event);
          } <span class="comment">// if i == 4</span>
        } <span class="comment">// if beamon</span>
      } <span class="comment">// if dtime-lasttime &gt; toggleDuration</span>

      <span class="comment">// Update the last known position in our database.</span>
      <span class="comment">// No need to test &#39;present&#39; because we know they are there.</span>
      memcpy(&amp;platheader.<a class="code" href="classDCSPlatformHeader.html#a858b836b96958e2072088ebef6d9e2df" title="Current data value.">platdata_</a>, &amp;platdata, <span class="keyword">sizeof</span>(platdata));
      <span class="keywordflow">if</span> (!headers.<a class="code" href="classDCSHeaderContainer.html#a8379a68452379d075d2166253171d2c0" title="Update an existing header.">update</a>(&amp;platheader, present))
      {
        sstr.str(<span class="stringliteral">&quot;&quot;</span>);
        sstr &lt;&lt; <span class="stringliteral">&quot;Failed to update platform &quot;</span> &lt;&lt; DCS::uint64totext(platheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(sstr.str().c_str());
      }

      <span class="comment">// For these two we decided not to declare separate structures,</span>
      <span class="comment">// but to update the contents of the headers directly.</span>
      <span class="keywordflow">if</span> (!headers.<a class="code" href="classDCSHeaderContainer.html#a8379a68452379d075d2166253171d2c0" title="Update an existing header.">update</a>(&amp;beamheader, present))
      {
        sstr.str(<span class="stringliteral">&quot;&quot;</span>);
        sstr &lt;&lt; <span class="stringliteral">&quot;Failed to update beam &quot;</span> &lt;&lt; DCS::uint64totext(beamheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(sstr.str().c_str());
      }

      <span class="keywordflow">if</span> (!headers.<a class="code" href="classDCSHeaderContainer.html#a8379a68452379d075d2166253171d2c0" title="Update an existing header.">update</a>(&amp;gateheader, present))
      {
        sstr.str(<span class="stringliteral">&quot;&quot;</span>);
        sstr &lt;&lt; <span class="stringliteral">&quot;Failed to update gate &quot;</span> &lt;&lt; DCS::uint64totext(gateheader.<a class="code" href="classDCSBaseData.html#a6f946ee83ded5dfc27808b654006b157" title="Unique id.">id_</a>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(sstr.str().c_str());
      }
    }

    <span class="comment">// Events for next time</span>
    <span class="keywordflow">if</span> (dtime-lasttime &gt; toggleDuration)
    {
      <span class="comment">// information text generic data</span>
      memset(genericDataValue, 0, <span class="keyword">sizeof</span>(genericDataValue));
      strncpy(genericDataValue, beamon?<span class="stringliteral">&quot;Beams on&quot;</span>:<span class="stringliteral">&quot;Beams off&quot;</span>, <span class="keyword">sizeof</span>(genericDataValue)-1);
      <a class="code" href="namespaceDCSCom.html#a2ddec14211b9c222d019cadd51c973e3" title="Send generic data to the client.">DCSCom::sendGenericData</a>(server, 0, dtime, -1, <span class="stringliteral">&quot;Simdis_InfoText&quot;</span>, genericDataValue);

      <span class="comment">// verify platform four exists</span>
      <span class="keywordflow">if</span> (platformFourCreated == <span class="keyword">true</span>)
      {
        <span class="comment">// animated line generic data</span>
        memset(genericDataValue, 0, <span class="keyword">sizeof</span>(genericDataValue));
        strncpy(genericDataValue, beamon?<span class="stringliteral">&quot;entityid=3&quot;</span>:<span class="stringliteral">&quot;entityid=5&quot;</span>, <span class="keyword">sizeof</span>(genericDataValue)-1);
        <a class="code" href="namespaceDCSCom.html#a2ddec14211b9c222d019cadd51c973e3" title="Send generic data to the client.">DCSCom::sendGenericData</a>(server, 4, dtime, -1, <span class="stringliteral">&quot;SIMDIS_AnimatedLine 1&quot;</span>, genericDataValue);

        <span class="keywordflow">if</span> (beamon)
        {
          <span class="comment">// cylinder generic data</span>
          memset(genericDataValue, 0, <span class="keyword">sizeof</span>(genericDataValue));
          strncpy(genericDataValue, <span class="stringliteral">&quot;x=-0.5,y=9,z=0,px=-1,py=0,pz=0,l=0,radiusNear=.5,radiusFar=0&quot;</span>, <span class="keyword">sizeof</span>(genericDataValue)-1);
          <a class="code" href="namespaceDCSCom.html#a2ddec14211b9c222d019cadd51c973e3" title="Send generic data to the client.">DCSCom::sendGenericData</a>(server, 4, dtime, -1, <span class="stringliteral">&quot;SIMDIS_Cylinder 1&quot;</span>, genericDataValue);
          memset(genericDataValue, 0, <span class="keyword">sizeof</span>(genericDataValue));
          strncpy(genericDataValue, <span class="stringliteral">&quot;x=-0.5,y=9,z=0,px=-1,py=0,pz=0,l=4,radiusNear=.5,radiusFar=0&quot;</span>, <span class="keyword">sizeof</span>(genericDataValue)-1);
          <a class="code" href="namespaceDCSCom.html#a2ddec14211b9c222d019cadd51c973e3" title="Send generic data to the client.">DCSCom::sendGenericData</a>(server, 4, dtime + (toggleDuration * 0.5), -1, <span class="stringliteral">&quot;SIMDIS_Cylinder 1&quot;</span>, genericDataValue);
          memset(genericDataValue, 0, <span class="keyword">sizeof</span>(genericDataValue));
          strncpy(genericDataValue, <span class="stringliteral">&quot;x=-0.5,y=9,z=0,px=-1,py=0,pz=0,l=0,radiusNear=.5,radiusFar=0&quot;</span>, <span class="keyword">sizeof</span>(genericDataValue)-1);
          <a class="code" href="namespaceDCSCom.html#a2ddec14211b9c222d019cadd51c973e3" title="Send generic data to the client.">DCSCom::sendGenericData</a>(server, 4, dtime + toggleDuration, -1, <span class="stringliteral">&quot;SIMDIS_Cylinder 1&quot;</span>, genericDataValue);

          <span class="comment">// scale example using generic data sent via UDP</span>
          memset(genericDataValue, 0, <span class="keyword">sizeof</span>(genericDataValue));
          strncpy(genericDataValue, <span class="stringliteral">&quot;1.0`1.0`1.0&quot;</span>, <span class="keyword">sizeof</span>(genericDataValue)-1);
          <a class="code" href="namespaceDCSCom.html#a2ddec14211b9c222d019cadd51c973e3" title="Send generic data to the client.">DCSCom::sendGenericData</a>(server, targetID, dtime, -1, <span class="stringliteral">&quot;Simdis_ScaleXYZ&quot;</span>, genericDataValue);
          memset(genericDataValue, 0, <span class="keyword">sizeof</span>(genericDataValue));
          strncpy(genericDataValue, <span class="stringliteral">&quot;1.0`4.0`1.0&quot;</span>, <span class="keyword">sizeof</span>(genericDataValue)-1);
          <a class="code" href="namespaceDCSCom.html#a2ddec14211b9c222d019cadd51c973e3" title="Send generic data to the client.">DCSCom::sendGenericData</a>(server, targetID, dtime + (toggleDuration * 0.5), -1, <span class="stringliteral">&quot;SIMDIS_ScaleXYZ&quot;</span>, genericDataValue);

          <span class="comment">// scale example using generic data sent via TCP</span>
          memset(genericDataValue, 0, <span class="keyword">sizeof</span>(genericDataValue));
          strncpy(genericDataValue, <span class="stringliteral">&quot;1.0`1.0`1.0&quot;</span>, <span class="keyword">sizeof</span>(genericDataValue)-1);
          <span class="comment">// Note:  Generic data tags are not case sensitive</span>
          <a class="code" href="classDCSGenericData.html" title="Generic data class.">DCSGenericData</a> gendata(targetID, dtime + toggleDuration, -1, <span class="stringliteral">&quot;simdis_scalexyz&quot;</span>, genericDataValue);
          <a class="code" href="namespaceDCSCom.html#a6cd751665075cee8ed3e69c843b848a6" title="Send data to the client via TCP.">DCSCom::sendTCPData</a>(server, <a class="code" href="DCSdefs_8h.html#a86381a2e8897f8ef0dc706fd4e79e1b5af255ca257ec48a21495eeab6b96f0833">DCSREQUEST_HEADER</a>, &amp;gendata);
          
          <span class="comment">// rocket burn example using generic data sent via TCP</span>
          memset(genericDataValue, 0, <span class="keyword">sizeof</span>(genericDataValue));
          sstr.str(<span class="stringliteral">&quot;&quot;</span>);
          sstr &lt;&lt; <span class="stringliteral">&quot;st=&quot;</span> &lt;&lt; toggleDuration &lt;&lt; <span class="stringliteral">&quot;,c=0xFF042EF9,p=-.5`-9`0,d=-15`0`0,rn=.7,rf=2.2,sc=1&quot;</span>;
          strncpy(genericDataValue, sstr.str().c_str(), <span class="keyword">sizeof</span>(genericDataValue)-1);
          <a class="code" href="classDCSGenericData.html" title="Generic data class.">DCSGenericData</a> gendata3(4, dtime, -1, <span class="stringliteral">&quot;SIMDIS_RocketBurn 1&quot;</span>, genericDataValue);
          <a class="code" href="namespaceDCSCom.html#a6cd751665075cee8ed3e69c843b848a6" title="Send data to the client via TCP.">DCSCom::sendTCPData</a>(server, <a class="code" href="DCSdefs_8h.html#a86381a2e8897f8ef0dc706fd4e79e1b5af255ca257ec48a21495eeab6b96f0833">DCSREQUEST_HEADER</a>, &amp;gendata3);
          memset(genericDataValue, 0, <span class="keyword">sizeof</span>(genericDataValue));
          sstr.str(<span class="stringliteral">&quot;&quot;</span>);
          sstr &lt;&lt; <span class="stringliteral">&quot;st=&quot;</span> &lt;&lt; toggleDuration &lt;&lt; <span class="stringliteral">&quot;,c=0xFF7DFFFB,p=-.5`-9`0,d=-15`0`0,rn=.5,rf=2,sc=1&quot;</span>;
          strncpy(genericDataValue, sstr.str().c_str(), <span class="keyword">sizeof</span>(genericDataValue)-1);
          <a class="code" href="classDCSGenericData.html" title="Generic data class.">DCSGenericData</a> gendata4(4, dtime, -1, <span class="stringliteral">&quot;SIMDIS_RocketBurn 2&quot;</span>, genericDataValue);
          <a class="code" href="namespaceDCSCom.html#a6cd751665075cee8ed3e69c843b848a6" title="Send data to the client via TCP.">DCSCom::sendTCPData</a>(server, <a class="code" href="DCSdefs_8h.html#a86381a2e8897f8ef0dc706fd4e79e1b5af255ca257ec48a21495eeab6b96f0833">DCSREQUEST_HEADER</a>, &amp;gendata4);
          <span class="comment">// The following command will also work, but data is sent via UDP</span>
          <span class="comment">// DCSCom::sendGenericData(server, 4, dtime, -1, &quot;SIMDIS_RocketBurn 2&quot;, genericDataValue);</span>
          
          <span class="keyword">static</span> <span class="keywordtype">int</span> count = 0;
          ++count;

          <span class="comment">// vapor trail example using generic data sent via TCP</span>
          <span class="keywordflow">if</span>(count == 1)
          {
            memset(genericDataValue, 0, <span class="keyword">sizeof</span>(genericDataValue));
            strncpy(genericDataValue, <span class="stringliteral">&quot;wake=1,initialRadius=.5,radiusExpansionRate=.5,fadeTime=40,numRadiFromPreviousSmoke=1.5,metersBehindCurrentPosition=3,vaporTextureNames=vapor1.rgba:vapor2.rgba:vapor3.rgba:vapor4.rgba&quot;</span>, <span class="keyword">sizeof</span>(genericDataValue)-1);
            <a class="code" href="classDCSGenericData.html" title="Generic data class.">DCSGenericData</a> gendata5(4, dtime, -1, <span class="stringliteral">&quot;SIMDIS_VaporTrail 1&quot;</span>, genericDataValue);
            <a class="code" href="namespaceDCSCom.html#a6cd751665075cee8ed3e69c843b848a6" title="Send data to the client via TCP.">DCSCom::sendTCPData</a>(server, <a class="code" href="DCSdefs_8h.html#a86381a2e8897f8ef0dc706fd4e79e1b5af255ca257ec48a21495eeab6b96f0833">DCSREQUEST_HEADER</a>, &amp;gendata5);
            <span class="comment">// The following command will also work, but data is sent via UDP</span>
            <span class="comment">// DCSCom::sendGenericData(server, 4, dtime, -1, &quot;SIMDIS_VaporTrail 1&quot;, genericDataValue);</span>
          }

          <span class="comment">// confidence category data via TCP</span>
          memset(genericDataValue, 0, <span class="keyword">sizeof</span>(genericDataValue));
          <span class="keywordflow">if</span>(count == 1)
          {
            strncpy(genericDataValue, <span class="stringliteral">&quot;Low&quot;</span>, <span class="keyword">sizeof</span>(genericDataValue)-1);
          }
          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(count == 2)
          {
            strncpy(genericDataValue, <span class="stringliteral">&quot;Medium&quot;</span>, <span class="keyword">sizeof</span>(genericDataValue)-1);
          }
          <span class="keywordflow">else</span>
          {
            count = 0;
            strncpy(genericDataValue, <span class="stringliteral">&quot;High&quot;</span>, <span class="keyword">sizeof</span>(genericDataValue)-1);
          }
          <a class="code" href="classDCSCategoryData.html" title="Category data class.">DCSCategoryData</a> catData (4, dtime, <span class="stringliteral">&quot;Confidence&quot;</span>, genericDataValue);
          <a class="code" href="namespaceDCSCom.html#a6cd751665075cee8ed3e69c843b848a6" title="Send data to the client via TCP.">DCSCom::sendTCPData</a>(server, <a class="code" href="DCSdefs_8h.html#a86381a2e8897f8ef0dc706fd4e79e1b5af255ca257ec48a21495eeab6b96f0833">DCSREQUEST_HEADER</a>, &amp;catData);
        }

        <span class="comment">// change icon</span>
        <span class="keyword">event</span>.id_ = 4;
        <span class="keyword">event</span>.eventtype_ = <a class="code" href="DCSdefs_8h.html#a7e76885674c4cd3e17cf421fff646c78a071ddedca552565f08f40f63188f6353">DCSEVENT_ICONNAME</a>;
        strncpy(event.<a class="code" href="classDCSEvent.html#aa6d3db4cfe6e54463d10ce9443e6ddb7" title="Event character data. Represents character array based data for scenario, platform, beam or gate objects.">chardata_</a>, beamon?<span class="stringliteral">&quot;p-3c_orion_nrl&quot;</span>:<span class="stringliteral">&quot;lear-36&quot;</span>, <span class="keyword">sizeof</span>(event.<a class="code" href="classDCSEvent.html#aa6d3db4cfe6e54463d10ce9443e6ddb7" title="Event character data. Represents character array based data for scenario, platform, beam or gate objects.">chardata_</a>)-1);
        <span class="keyword">event</span>.time_ = dtime;
        <a class="code" href="namespaceDCSCom.html#a3ce08f8cc5cfba107338024f891bf626" title="Send an event to the client.">DCSCom::sendEvent</a>(server, &amp;event);

        <span class="comment">// change callsign</span>
        <span class="keyword">event</span>.id_ = 4;
        <span class="keyword">event</span>.eventtype_ = <a class="code" href="DCSdefs_8h.html#a7e76885674c4cd3e17cf421fff646c78a07231b5d7d712d886823d5d1992d9dd5">DCSEVENT_CALLSIGN</a>;
        strncpy(event.<a class="code" href="classDCSEvent.html#aa6d3db4cfe6e54463d10ce9443e6ddb7" title="Event character data. Represents character array based data for scenario, platform, beam or gate objects.">chardata_</a>, beamon?<span class="stringliteral">&quot;Plane&quot;</span>:<span class="stringliteral">&quot;Jet&quot;</span>, <span class="keyword">sizeof</span>(event.<a class="code" href="classDCSEvent.html#aa6d3db4cfe6e54463d10ce9443e6ddb7" title="Event character data. Represents character array based data for scenario, platform, beam or gate objects.">chardata_</a>)-1);
        <span class="keyword">event</span>.time_ = dtime;
        <a class="code" href="namespaceDCSCom.html#a3ce08f8cc5cfba107338024f891bf626" title="Send an event to the client.">DCSCom::sendEvent</a>(server, &amp;event);
        strncpy(event.<a class="code" href="classDCSEvent.html#aa6d3db4cfe6e54463d10ce9443e6ddb7" title="Event character data. Represents character array based data for scenario, platform, beam or gate objects.">chardata_</a>, beamon?<span class="stringliteral">&quot;Plane Beam&quot;</span>:<span class="stringliteral">&quot;Jet Beam&quot;</span>, <span class="keyword">sizeof</span>(event.<a class="code" href="classDCSEvent.html#aa6d3db4cfe6e54463d10ce9443e6ddb7" title="Event character data. Represents character array based data for scenario, platform, beam or gate objects.">chardata_</a>)-1);
        <span class="keyword">event</span>.id_ = 14;
        <a class="code" href="namespaceDCSCom.html#a3ce08f8cc5cfba107338024f891bf626" title="Send an event to the client.">DCSCom::sendEvent</a>(server, &amp;event);
        strncpy(event.<a class="code" href="classDCSEvent.html#aa6d3db4cfe6e54463d10ce9443e6ddb7" title="Event character data. Represents character array based data for scenario, platform, beam or gate objects.">chardata_</a>, beamon?<span class="stringliteral">&quot;Plane Gate&quot;</span>:<span class="stringliteral">&quot;Jet Gate&quot;</span>, <span class="keyword">sizeof</span>(event.<a class="code" href="classDCSEvent.html#aa6d3db4cfe6e54463d10ce9443e6ddb7" title="Event character data. Represents character array based data for scenario, platform, beam or gate objects.">chardata_</a>)-1);
        <span class="keyword">event</span>.id_ = 24;
        <a class="code" href="namespaceDCSCom.html#a3ce08f8cc5cfba107338024f891bf626" title="Send an event to the client.">DCSCom::sendEvent</a>(server, &amp;event);

        <span class="comment">// change classification</span>
        <span class="keyword">event</span>.id_ = 4;
        <span class="keyword">event</span>.eventtype_ = <a class="code" href="DCSdefs_8h.html#a7e76885674c4cd3e17cf421fff646c78a04cc7794759872c8701e1351d19b046f">DCSEVENT_CLASSIFICATIONSTR</a>;
        strncpy(event.<a class="code" href="classDCSEvent.html#aa6d3db4cfe6e54463d10ce9443e6ddb7" title="Event character data. Represents character array based data for scenario, platform, beam or gate objects.">chardata_</a>, beamon?<span class="stringliteral">&quot;GOTS&quot;</span>:<span class="stringliteral">&quot;SIMDIS&quot;</span>, <span class="keyword">sizeof</span>(event.<a class="code" href="classDCSEvent.html#aa6d3db4cfe6e54463d10ce9443e6ddb7" title="Event character data. Represents character array based data for scenario, platform, beam or gate objects.">chardata_</a>)-1);
        <span class="keyword">event</span>.data_ = beamon?0x600000FF:0x60FF00FF;
        <span class="keyword">event</span>.time_ = dtime;
        <a class="code" href="namespaceDCSCom.html#a3ce08f8cc5cfba107338024f891bf626" title="Send an event to the client.">DCSCom::sendEvent</a>(server, &amp;event);

        <span class="comment">// change draw mode</span>
        ++drawModeCount;
        memset(genericDataValue, 0, <span class="keyword">sizeof</span>(genericDataValue));
        sstr.str(<span class="stringliteral">&quot;&quot;</span>);
        sstr &lt;&lt; (drawModeCount % 3);
        strncpy(genericDataValue, sstr.str().c_str(), <span class="keyword">sizeof</span>(genericDataValue)-1);
        <a class="code" href="namespaceDCSCom.html#a2ddec14211b9c222d019cadd51c973e3" title="Send generic data to the client.">DCSCom::sendGenericData</a>(server, 4, dtime, -1, <span class="stringliteral">&quot;SIMDIS_DrawMode&quot;</span>, genericDataValue);
      }
     
      lasttime = dtime;
      beamon = !beamon;
      
      <span class="comment">// Increment color once for every blink</span>
      <span class="keywordflow">if</span> (beamon)
      {
        <span class="keywordflow">if</span> (++coloroffset &gt;= 10)
        {
          coloroffset = 0;
        }
      }
    }

    <span class="comment">// See if our clients want anything</span>
    <a class="code" href="namespaceDCSCom.html#a441acbd299a7b2091ee317262eea72b7" title="Process any requests from all clients in client list.">DCSCom::serverProcessRequests</a>(server, timeheader, scenheader, headers);

    <span class="comment">// Now see if any connections died</span>
    <span class="keywordflow">if</span> (!server.<a class="code" href="structDCSCom_1_1DCSServerInfo.html#a791f86c2007f9fb34369667554a6ed5b" title="TCP closed connection list.">vagrants</a>.empty())
    {
      DCSCom::ClientList::iterator s = server.<a class="code" href="structDCSCom_1_1DCSServerInfo.html#a791f86c2007f9fb34369667554a6ed5b" title="TCP closed connection list.">vagrants</a>.begin();
      <span class="keywordflow">for</span> (;s != server.<a class="code" href="structDCSCom_1_1DCSServerInfo.html#a791f86c2007f9fb34369667554a6ed5b" title="TCP closed connection list.">vagrants</a>.end(); s++)
      {
        sstr.str(<span class="stringliteral">&quot;&quot;</span>);
        sstr &lt;&lt; <span class="stringliteral">&quot;Connection from &quot;</span> &lt;&lt; (*s)-&gt;getAddress(addr, <span class="keyword">sizeof</span>(addr)) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; (*s)-&gt;getPort() &lt;&lt; <span class="stringliteral">&quot; lost\n&quot;</span>;
        logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(sstr.str().c_str());
      }

      <a class="code" href="namespaceDCSCom.html#ac5bd726b2daad802e33e355e11f3e872" title="Clear out any sockets that appear in the vagrant list.">DCSCom::serverExpelVagrants</a>(server);
    }
    
    cout &lt;&lt; <span class="stringliteral">&quot;Server time: &quot;</span> &lt;&lt; dtime &lt;&lt; endl;
    
    <span class="comment">// check for keyboard entry, more specifically the q key</span>
<span class="preprocessor">#ifdef WIN32</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (_kbhit())
    {
      <span class="keywordtype">char</span> keyPressed = _getch();
      <span class="keywordflow">if</span> (keyPressed == <span class="charliteral">&#39;q&#39;</span>)
        running=<span class="keyword">false</span>;
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>  } <span class="comment">// end of while (running)</span>

  logger.<a class="code" href="classDCSConsoleLogger.html#a2549c4322a918beca0322ffcbf6c3629" title="Log DCS data.">log</a>(<span class="stringliteral">&quot;Shutting down\n&quot;</span>);
  <a class="code" href="namespaceDCSCom.html#ab46b492034083572a8590d6129e62a63" title="Server shutdown.">DCSCom::serverStop</a>(server);

  <span class="comment">// Free resources allocated for our discovery daemon.</span>
  DCSDisc::discoverFree(discover);

  <span class="comment">// Socket finalization status, For the PC, this function calls the WSACleanup.</span>
  <span class="comment">// An application or DLL is required to perform a successful WSAStartup call</span>
  <span class="comment">// before it can use Windows Sockets services. When it has completed the use</span>
  <span class="comment">// of Windows Sockets, the application or DLL must call WSACleanup to</span>
  <span class="comment">// deregister itself from a Windows Sockets implementation and allow the</span>
  <span class="comment">// implementation to free any resources allocated on behalf of the</span>
  <span class="comment">// application or DLL. Any pending blocking or asynchronous calls issued by</span>
  <span class="comment">// any thread in this process are canceled without posting any notification</span>
  <span class="comment">// messages or without signaling any event objects. Any pending overlapped</span>
  <span class="comment">// send and receive operations (WSASend/WSASendTo/WSARecv/WSARecvFrom with</span>
  <span class="comment">// an overlapped socket) issued by any thread in this process are also</span>
  <span class="comment">// canceled without setting the event object or invoking the completion</span>
  <span class="comment">// routine, if specified. In this case, the pending overlapped operations</span>
  <span class="comment">// fail with the error status WSA_OPERATION_ABORTED.</span>
  <span class="comment">// Sockets that were open when WSACleanup was called are reset and</span>
  <span class="comment">// automatically deallocated .</span>
  <span class="comment">// There must be a call to WSACleanup for every successful call to WSAStartup</span>
  <span class="comment">// made by a task. Only the final WSACleanup for that task does the actual</span>
  <span class="comment">// cleanup; the preceding calls simply decrement an internal reference count</span>
  <span class="comment">// in the Ws2_32.dll.</span>
  finalizeSocket();

  <span class="keywordflow">return</span> 0;
}
</pre></div> </div></div><!-- contents -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title></title>
   
</head>
  <body>
           
<hr>    <br>
      2002-2008 U.S. Naval Research Laboratory. &nbsp;The 
U.S. Government retains   all rights  to use, duplicate, distribute, disclose,
 or release this document.   &nbsp;<br>
         <br>
         For further information regarding DCS or SIMDIS please visit <a
 href="https://simdis.nrl.navy.mil">https://simdis.nrl.navy.mil</a> or send e-mail to <a
 href="mailto:simdis@enews.nrl.navy.mil">simdis@enews.nrl.navy.mil</a>. &nbsp;<br>
         <br>
         Copies of DCS and SIMDIS, as well as this manual and other related 
 information,&nbsp;    may be obtained from <a
 href="https://simdis.nrl.navy.mil">https://simdis.nrl.navy.mil</a>.    &nbsp;<br>
         <br>
                 
<hr width="100%" size="2">   
<address><small>Generated at Mon Mar 26 2012 08:06:29 for the DCS API by <a
 href="http://www.stack.nl/%7Edimitri/doxygen/index.html">doxygen</a> 1.7.6.1.</small></address>
 <br>
 <br>
 <br>
 
</body>
</html>
